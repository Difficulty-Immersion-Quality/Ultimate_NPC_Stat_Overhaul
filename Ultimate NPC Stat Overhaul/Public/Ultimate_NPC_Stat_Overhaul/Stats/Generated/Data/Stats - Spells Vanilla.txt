// ==================================== Animate Dead++ versions of Animate Dead that NPCs actually use ====================================
// Replace IsTargetableCorpse() with manual implementation to get around many damage types rendering corpses unusable. Stack limits re-implemented.

new entry "Target_AnimateDead_Skeleton"
type "SpellData"
data "SpellType" "Target"
// using "Target_AnimateDead"
using "Target_AnimateDead_Skeleton"
// data "SpellProperties" "SwitchDeathType(Explode);Summon(6c06cda2-6e13-4663-a6f6-c4bb7564c10f, UntilLongRest,,,'AnimateDeadStack',UNSUMMON_ABLE,SHADOWCURSE_SUMMON_CHECK) "
data "SpellProperties" "TARGET:SwitchDeathType(Explode);GROUND:IF(HasPassive('UndeadThrall_BetterSummon',context.Source)):Summon(6c06cda2-6e13-4663-a6f6-c4bb7564c10f,UntilLongRest,Projectile_AiHelper_Summon_Weak,,'AnimateDeadStack',UNDEADTHRALL_SUMMON,UNSUMMON_ABLE,SHADOWCURSE_SUMMON_CHECK);GROUND:IF(not HasPassive('UndeadThrall_BetterSummon',context.Source)):Summon(6c06cda2-6e13-4663-a6f6-c4bb7564c10f, UntilLongRest,Projectile_AiHelper_Summon_Weak,,'AnimateDeadStack',UNSUMMON_ABLE,SHADOWCURSE_SUMMON_CHECK);TARGET:IF(Tagged('BONE_CORPSE_PILE')):ApplyStatus(ANIMATEDEAD_ASHPILE,100,-1);TARGET:ApplyStatus(CRAWLING_GNAW_TECHNICAL,100,-1)"
// data "TargetConditions" "IsTargetableCorpse() and CanStand('6c06cda2-6e13-4663-a6f6-c4bb7564c10f') and TargetSizeEqualOrSmaller(Size.Medium)  and SizeEqualOrGreater(Size.Small)"
data "TargetConditions" "CanStand('6c06cda2-6e13-4663-a6f6-c4bb7564c10f') and not HasStatus('CRAWLING_GNAW_TECHNICAL') and (Dead() and not Party() and not HasAnyTags({'PLAYABLE','AVATAR','CONSTRUCT','PLANT','FUNGUS','INANIMATE','ELEMENTAL','OOZE','GHOST'}) and TargetSizeEqualOrSmaller(Size.Medium) and SizeEqualOrGreater(Size.Small)) or Tagged('BONE_CORPSE_PILE') or HasStatus('BONE_ZONE',context.Source) or HasStatus('ANIMATEDEAD_ZONE',context.Source)"
data "AmountOfTargets" "1"
data "SpellFlags" "HasVerbalComponent;HasSomaticComponent;IsSpell;IgnorePreviouslyPickedEntities"

new entry "Target_AnimateDead_Zombie"
type "SpellData"
data "SpellType" "Target"
// using "Target_AnimateDead"
using "Target_AnimateDead_Zombie"
// data "SpellProperties" "SwitchDeathType(Explode);Summon(c2a2c269-ede8-4887-99f1-e0c044cc0c75,UntilLongRest,,,'AnimateDeadStack',UNSUMMON_ABLE,SHADOWCURSE_SUMMON_CHECK)"
data "SpellProperties" "TARGET:SwitchDeathType(Explode);GROUND:IF(HasPassive('UndeadThrall_BetterSummon',context.Source)):Summon(c2a2c269-ede8-4887-99f1-e0c044cc0c75,UntilLongRest,Projectile_AiHelper_Summon_Weak,,'AnimateDeadStack',UNDEADTHRALL_SUMMON,UNSUMMON_ABLE,SHADOWCURSE_SUMMON_CHECK);GROUND:IF(not HasPassive('UndeadThrall_BetterSummon',context.Source)):Summon(c2a2c269-ede8-4887-99f1-e0c044cc0c75, UntilLongRest,Projectile_AiHelper_Summon_Weak,,'AnimateDeadStack',UNSUMMON_ABLE,SHADOWCURSE_SUMMON_CHECK);TARGET:IF(Tagged('CORPSE_PILE')):ApplyStatus(ANIMATEDEAD_EXPLODED_CORPSE,100,-1);TARGET:ApplyStatus(CRAWLING_GNAW_TECHNICAL,100,-1)"
// data "TargetConditions" "IsTargetableCorpse() and CanStand('c2a2c269-ede8-4887-99f1-e0c044cc0c75') and TargetSizeEqualOrSmaller(Size.Medium)  and SizeEqualOrGreater(Size.Small)"
data "TargetConditions" "CanStand('b7f1c55b-5e2e-4272-aa73-7deba553d1c1') and not HasStatus('CRAWLING_GNAW_TECHNICAL') and (Dead() and not Party() and not HasAnyTags({'PLAYABLE','AVATAR','CONSTRUCT','PLANT','FUNGUS','INANIMATE','ELEMENTAL','OOZE','GHOST'}) and TargetSizeEqualOrSmaller(Size.Medium) and SizeEqualOrGreater(Size.Small)) or Tagged('CORPSE_PILE') or HasStatus('ANIMATEDEAD_ZONE',context.Source)"
data "AmountOfTargets" "1"
data "SpellFlags" "HasVerbalComponent;HasSomaticComponent;IsSpell;IgnorePreviouslyPickedEntities"